
name: ADL Create With Update Team
on:
  workflow_dispatch:
   inputs:
     org-name:
       description: 'Organization'
       required: true
       type: string
       default: 'AlightEngineering'
     development-team-name:
       description: 'Development team name'
       required: true
       type: string
       default: 'no-team-provided'
     member-name-list:
       description: 'GitHub names of team members'
       required: true
       type: array
       default: ''
jobs:
  adl-add-members:
    runs-on: ubuntu-latest
    steps:
    - name: Create ADL Team
      env:
        GH_TOKEN: ${{ secrets.GH_CLONE_REPO }}
      run: |
        if [[ ${{ inputs.development-team-name }} = "no-team-provided" ]]
        then
          echo "Please specify group"
          exit 1
        fi
        echo ${{ inputs.org-name }}
        echo ${{ inputs.development-team-name }}
        echo ${{ inputs.member-name-list }}
        gh api --method POST  -H "Accept: application/vnd.github+json" -H "X-GitHub-Api-Version: 2022-11-28" /orgs/${{ inputs.org-name }}/teams -f name=${{ inputs.development-team-name }} -f permission='push' -f privacy='closed' || true
    - name: Sleep After Create Team
      run: |
        # There is a lag between creating a team and having that team be available to other gh api calls -- its a github thing...
        echo "Sleeping for 120 seconds..."
        sleep 120
        echo "Waking up..."
    - name: Add Members To Team
      env:
        GH_TOKEN: ${{ secrets.GH_CLONE_REPO }}
      run: |
        for member_name in ${{ inputs.member-name-list }}
        do
          echo "Executing gh api call on: /org/${{ inputs.org-name }}/teams/${{ inputs.development-team-name }}/memberships/${member_name}"
          gh api --method PUT -H "Accept: application/vnd.github+json" -H "X-GitHub-Api-Version: 2022-11-28" /orgs/${{ inputs.org-name }}/teams/${{ inputs.development-team-name }}/memberships/${member_name} -f role='member' || true
          #gh api --method PUT -H "Accept: application/vnd.github+json" -H "X-GitHub-Api-Version: 2022-11-28" /orgs/${{ inputs.org-name }}/teams/${{ inputs.development-team-name }}/memberships/${member_name} -f role='maintainer'
        done
        gh api --method PUT -H "Accept: application/vnd.github+json" -H "X-GitHub-Api-Version: 2022-11-28" /orgs/${{ inputs.org-name }}/teams/${{ inputs.development-team-name }}/memberships/dushyant-remivasan-alight -f role='maintainer'



Executing gh api call on: /org/AlightEngineering/teams/adl-adldataops-developers/memberships/dinesh-sadasivam-alight
gh: You must be an organization owner or team maintainer to add a team membership. (HTTP 403)
gh: You must be an organization owner or team maintainer to add a team membership. (HTTP 403)
{"message":"You must be an organization owner or team maintainer to add a team membership.","documentation_url":"https://docs.github.com/rest/teams/members#add-or-update-team-membership-for-a-user"}{"message":"You must be an organization owner or team maintainer to add a team membership.","documentation_url":"https://docs.github.com/rest/teams/members#add-or-update-team-membership-for-a-user"}
Error: Process completed with exit code 1.
